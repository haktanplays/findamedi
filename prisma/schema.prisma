generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
  CLINIC
}

enum SubscriptionPlan {
  STANDARD
  PREMIUM
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELLED
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

model Clinic {
  id                    String              @id @default(cuid())
  name                  String
  slug                  String              @unique
  description           String
  shortDescription      String?
  email                 String
  phone                 String
  whatsapp              String?
  website               String?
  logoUrl               String?
  coverImageUrl         String?
  address               String
  city                  String
  district              String
  latitude              Decimal?
  longitude             Decimal?
  rating                Decimal             @default(0) @db.Decimal(3, 2)
  reviewCount           Int                 @default(0)
  viewCount             Int                 @default(0)
  clickCount            Int                 @default(0)
  isActive              Boolean             @default(true)
  isVerified            Boolean             @default(false)
  isFeatured            Boolean             @default(false)
  subscriptionPlan       SubscriptionPlan     @default(STANDARD)
  subscriptionStatus     SubscriptionStatus   @default(ACTIVE)
  subscriptionStartDate   DateTime?
  subscriptionEndDate    DateTime?
  priceRangeMin         Int?
  priceRangeMax         Int?
  establishedYear       Int?
  socialLinks           Json?
  seoTitle              String?
  seoDescription        String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  doctors               Doctor[]
  beforeAfterImages     BeforeAfter[]
  reviews               Review[]
  treatments            Treatment[]
  categories            ClinicCategory[]
  clinicStats           ClinicStats[]
  user                  User?

  @@index([slug])
  @@index([city])
  @@index([isActive])
  @@index([isFeatured])
}

model Doctor {
  id                 String      @id @default(cuid())
  clinicId           String
  name               String
  specialty          String
  title              String?
  bio                String?
  photoUrl           String?
  experienceYears    Int?
  education          Json?
  certifications      Json?
  languages          Json?
  isActive           Boolean     @default(true)
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt

  clinic             Clinic      @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  beforeAfterImages  BeforeAfter[]

  @@index([clinicId])
}

model Category {
  id          String          @id @default(cuid())
  name        String
  slug        String          @unique
  description String?
  icon        String?
  isActive    Boolean         @default(true)
  order       Int             @default(0)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  clinics     ClinicCategory[]
  treatments  Treatment[]

  @@index([slug])
  @@index([isActive])
}

model Treatment {
  id          String          @id @default(cuid())
  clinicId    String
  categoryId  String?
  name        String
  description String?
  priceMin    Int?
  priceMax    Int?
  duration    String?
  isActive    Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  clinic      Clinic          @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  category    Category?       @relation(fields: [categoryId], references: [id])
  beforeAfterImages BeforeAfter[]

  @@index([clinicId])
  @@index([categoryId])
}

model BeforeAfter {
  id               String    @id @default(cuid())
  clinicId         String
  treatmentId      String?
  doctorId         String?
  title            String?
  beforeImageUrl    String
  afterImageUrl     String
  treatmentDate    DateTime?
  patientAge       Int?
  patientGender    String?
  isActive         Boolean   @default(true)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  clinic           Clinic    @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  treatment        Treatment? @relation(fields: [treatmentId], references: [id])
  doctor           Doctor?   @relation(fields: [doctorId], references: [id])

  @@index([clinicId])
}

model Review {
  id              String        @id @default(cuid())
  clinicId        String
  name            String
  country         String?
  rating          Int
  comment         String
  treatment       String?
  isVerified      Boolean       @default(false)
  status          ReviewStatus  @default(PENDING)
  adminResponse   String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  clinic          Clinic        @relation(fields: [clinicId], references: [id], onDelete: Cascade)

  @@index([clinicId])
  @@index([status])
}

model ClinicStats {
  id              String   @id @default(cuid())
  clinicId        String
  date            DateTime
  views           Int      @default(0)
  clicks          Int      @default(0)
  uniqueVisitors  Int      @default(0)
  countryViews    Json?

  clinic          Clinic   @relation(fields: [clinicId], references: [id], onDelete: Cascade)

  @@unique([clinicId, date])
  @@index([clinicId])
  @@index([date])
}

model ClinicCategory {
  clinicId    String
  categoryId  String

  clinic      Clinic    @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  category    Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@id([clinicId, categoryId])
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  role          UserRole   @default(USER)
  clinicId      String?    @unique
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  clinic        Clinic?    @relation(fields: [clinicId], references: [id])
  accounts      Account[]
  sessions      Session[]
  verificationTokens VerificationToken[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime
  user       User     @relation(fields: [identifier], references: [email], onDelete: Cascade)

  @@unique([identifier, token])
}
